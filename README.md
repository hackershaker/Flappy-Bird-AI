# Flappy Bird RL 환경 구현 및 시뮬레이션

Flappy Bird 강화 학습 실험을 위해 Gym 스타일 API를 사용하여 제작된 간단한 게임 환경 구현체이다. DQN, PPO, Policy Gradient 등 다양한 RL 알고리즘을 테스트하기에 적합하도록 상태(State), 행동(Action), 보상(Reward) 구조를 학습 친화적으로 설계하였다.

---

## 사용법
프로젝트 폴더 내로 입력하고 다음 명령어를 입력하면, Q테이블을 학습하고 그것을 바탕으로 시뮬레이션을 실행한다.
```python src/main_test.py```

--

## 주요 특징

- Flappy Bird 구조 기반: 기본적인 게임 플레이 메커니즘을 반영한다.
- 단순한 상태 공간: 4개의 관측값으로 구성된 학습 최적화 상태 제공.
- 충돌 판정 구현: 새와 파이프, 화면 상/하 경계 충돌 감지.
- 간단한 물리: 중력, 속도 변화 로직 적용.
- Gym 스타일 API 호환: `reset()`, `step()` 제공.
- 파이프 관리: 화면을 벗어난 파이프는 오른쪽에서 자동 재생성된다.

---

## 상태 공간 (State Space)

환경은 새와 가장 가까운 파이프 정보를 포함하는 **4차원 NumPy 배열**을 반환한다.

| 인덱스 | 변수명 | 설명 |
| :---: | :---: | :--- |
| 0 | `bird_y` | 새의 세로 위치(y 좌표) |
| 1 | `bird_vel` | 새의 세로 속도 |
| 2 | `pipe_x` | 다음 파이프의 가로 위치(x 좌표) |
| 3 | `pipe_y` | 다음 파이프 구멍의 상단 y 좌표 |

수식 표현:

$$\text{state} = \text{np.array}([bird\_y, \text{bird\_vel}, \text{pipe\_x}, \text{pipe\_y}])$$

---

## 행동 공간 (Action Space)

이산적 두 가지 행동으로 구성된다.

| 행동 | 값 | 설명 |
| :---: | :---: | :--- |
| 0 | 아무것도 하지 않음 | 중력 영향만 적용 |
| 1 | 점프 | 세로 속도를 즉시 -10으로 설정 |

---

## 보상 구조 (Reward Structure)

생존 시간 극대화를 유도한다.

| 상황 | 보상 | 의도 |
| :---: | :---: | :--- |
| 살아있는 매 스텝 | +1 | 오래 생존하도록 유도 |
| 충돌로 종료 | -100 | 충돌을 강하게 억제 |

---

## 물리 및 이동 규칙

- **중력 적용**  
  `bird_vel += 1`
- **위치 업데이트**  
  `bird_y += bird_vel`
- **점프**  
  행동 1일 때 `bird_vel = -10`
- **파이프 이동**  
  `pipe_x -= 3`
- **파이프 리스폰 조건**  
  `pipe_x < -50`이면 파이프를 오른쪽으로 되돌리고 `pipe_y`를 랜덤하게 재설정한다.

---

## 파이프 모델 및 충돌 판정

### 파이프 모델

- 새의 가로 좌표는 고정: `50px`
- 파이프만 왼쪽으로 이동하는 상대적 움직임 구조
- 파이프 너비는 `50px`로 고정

### 충돌 판정

충돌은 다음 두 조건이 모두 참일 때 발생한다.

1. 새의 x 좌표가 파이프 영역 안에 있을 때:

   $$\text{pipe\_x} < 50 < \text{pipe\_x} + 50$$

2. 새의 y 좌표가 파이프 구멍 범위 밖일 때:

   $$\text{not}(\text{pipe\_y} < \text{bird\_y} < \text{pipe\_y} + \text{pipe\_gap})$$

코드 예시:

```python
if self.pipe_x < 50 < self.pipe_x + 50 \
    and not (self.pipe_y < self.bird_y < self.pipe_y + self.pipe_gap):
    self.done = True
```

## 추후 개선 사항

- 파이프 너비 변수화 (pipe_width)
- Hitbox 정확도 향상
- 새의 x 좌표를 state에 포함
- render() 시각화 기능 추가
- OpenAI Gym 스타일 환경으로 확장
- 난이도 옵션 다양화